# Интерпретация паттерна MVC в функциональном стиле

---
## Установка
1. Развернуть репозиторий на сервере
2. Сделать папку "public" корневой в настройках apache
3. Создать базу данных
4. Загрузить дамп mvc-func.sql в базу данных
5. Перейти в "config/db.php" и заполнить настройки для входа в базу данных
6. Перейти в "public/js/config.js"
7. Указать адресс сайта вместо "http://func-mvc/" в аналогичном формате

---
## Устройство проекта

- Точка входа — "public/index.php".
- В папке "Controllers" находятся контроллеры
- В папке "models" находятся модели
- В папке "config" находятся настройки для проекта
- в папке "vendor" находятся основные вспомогательные функции
- В папке "views" находятся страницы

Вызываемый контроллер и метод отпределяется путём получения GET-параметров. По умолчанию, если не указан контроллер, вызывается контроллер indexController. Если не указан метод, вызывается indexAction.

Файл .htaccess позволяет сформировать ЧПУ. В результате чего URL приобретает вид: <адресс сайта>/<контроллер>/<метод>/

Вывод страницы происходит путём вызова вспомогательного метода **load**. Метод принимает на вход название контроллера и метода, после чего генерирует путь до них путём использования функции "include_once" и констант, определённых в "config/config.php".

В контроллере находится основная логика сайта. Генерация самой страницы происходит путём вызова вспомогательного метода **render**. Метод принимает на вход название view и массив с параметрами, который передаются на страницу.

В моделях собрана основная логика работы с базой данных. Для каждой таблицы создан отдельный файл.

Для view также создан шаблон, позволяющий добавлять header и footer к каждой странице. Header и footer находятся в папке "views/layouts"

---

## Функциональность

### - Шапка сайта

В шапке сайта присутстуют следующие элементы:

- Название сайта. Клик по названию вызывает переход на главную страницу сайта.
- Категории. Наведение на этот элемент вызывает появление многоуровнего списка с категориями. Клик на название какой-либо категории вызывает вывод страницы этой категории.
- Каталог. Главная страница сайта, на которой выводятся все товары.
- Корзина. Корзина товаров.
- Вход. Страница входа в аккаунт.
- Регистрация. Страница регистрации.

### - Главная страница (Каталог)
На главной странице сайта представлен каталог. Выводятся все товары, которые есть в базе, а также их количество. Если количество товаров 0 — в карточке товара появляется сообщение "Нет в наличии".

Кнопка "В корзину" позволяет добавить товар в корзину. В шапке сайта появляется количество товаро, которое есть в корзине. В корзину нельззя добавить больше товаров, чем сейчас есть в наличии.

За работу главной страницы отвечают следующие файлы:
- controllers/IndexController.php — основной котроллер страницы
- models/ProductModel.php — модель товаров
- models/CategoryModel.php — модель категорий. Нужна для того, чтобы поместить в карточке товара ссылку на категорию
- views/index.php — главная страница

### - Страница категории
На странице категории выводятся все товары, которые относятся к данной категории. Если категория является родительской - будет выведен также список дочерних категорий.

Если в базе нет товаров, которые бы относились к данной категории, на странице появится сообщение "Товаров не найдено".

За работу страницы категорий отвечают следующие файлы:
- controllers/CategoryController.php — основной котроллер страницы
- models/CategoryModel.php — модель категорий
- models/ProductModel.php — модель товаров для вывода товаров определённой категории
- views/category.php — страница категорий

### - Корзина
В корзине отображаются все товары, которые были в неё добавлены на главной странице или на странице категории. Товары можно удалять или изменять их количество. Также происходит автомотическое изменение итоговой суммы конкретного товара или всего заказа. Делается это при помощи функции fetch в js и с помощью глобальной переменной $_SESSION в php.

За работу корзины отвечают следующие файлы:
- controllers/CartApiController.php — файл, в котором собраны все функции для работы с JavaScript
- controllers/CartController.php — основной контроллер страницы
- public/js/cart.js — файл, который отвечает за асинхронный обмен данными с сервером (удаление/изменение количества товаров)
- views/cart.php — страница корзины

### - Страница входа
На эту страницу можно попасть двумя способами: по ссылке "Вход" в шапке сайта, либо при оформлении заказа, если пользователь не авторизирован. Страница содержит в себе форму с двумя полями: email и пароль.

За работу страницы входа отвечают следующие файлы:
- controllers/LoginController.php — основной контроллер страницы
- models/UserModel.php — модель пользователя. Нужня для проверки наличия пользователя в базе данных и последующей авторизации
- views/login.php — страница входа

### - Страница регистрации

Страница регистрации пользователя. Содержит всебе форму со следующими полями:
- ФИО
- Почта
- Пароль
- Подтверждение пароля

Происходит проверка совпадение паролей, а также наличие в базе данных пользователя с той же почной.

За работу страницы регистрации отвечают следующие файлы:
- controllers/RegisterController.php — основной контроллер страницы
- models/UserModel.php — модель пользователя. Нужня для проверки наличия пользователя в базе данных и последующей авторизации
- views/register.php — страница авторизации

### - Страница заказа

Как только авторизированный пользователь оформляет заказ в корзине — он попадает на страницу заказа. На ней он может увидеть все товары, их количество, стоимость каждого товара, статус заказа, а также общую стоимость заказа. На странице заказа присутствует кнопка "Отменить заказ", которая позволяет отменить заказ. Количество товаров в базе данных изменится на прежднее.

За работу страницы заказа отвечают следующие файлы:
- controllers/OrderController.php — основной контроллер заказов (не только этой страницы)
- models/UserModel.php — для вывода заказа только в том случае, если его оформлял текущий авторизированный пользователь
- models/ProductModel.php — модель для молучения всех товаров заказа
- models/OrderStatusModel.php — модель для получения статуса заказа
- models/CategoryModel.php — модель для получения категорий товаров
- models/OrdersProductModel.php — промежуточная таблица для определения товаров, которые входят в заказ, их количества и стоимости
- views/order.php — страница заказа

### - Страница всех заказов пользователя

На этой странице можно посмотреть список всех заказов, которые относятся к польхователю, а также перейти на страницу каждого заказа.

За работу страницы всех заказов пользователя отвечают файлы:
- controllers/OrderController.php — основной контроллер заказов. В данном случае используется метод **myOrdersAction**.
- models/UserModel.php — для вывода заказов только текущего пользователя
- models/OrderStatusModel.php — модель для получения статуса заказа
- views/myOrders.php — страница заказов

---
## Админка

Следующий функционал доступен только пользователю, который имеет роль администратора. По умолчанию в базе есть только один администратор: 
Почта: admin@admin.ru
Пароль: admin

Ссынки на страницы администратора находятся в выпадающем списке "Админка" в шапке сайта.

### - Все заказы

На странице представлен список всех заказов всех пользователей, а также имеется возможность просмотреть каждый заказ по отдельности и обновить их статус. В случае отмены заказа товарам, которые внего входят, возвращается их количество. Статус отменённого заказа невозможно изменить.

За работу страницы всех заказов отвечают файлы:
- controllers/OrderController.php — основной контроллер заказов. В данном случае используется метод **allAction**
- controllers/OrderApiController.php — файл для асинхронного обмена данными с сервером. Нужен для изменения статуса заказа без перезагрузки страницы
- models/UserModel.php — для вывода информации о пользователе, создавшем заказ
- models/OrderStatusModel.php — модель для получения статуса заказа
- views/allOrders.php — страница заказо
- public/admin.js — файл, который отвечает за асинхронный обмен данными с сервером (изменение статуса заказа)

### - Управление товарами

Страница для добавления и изменения товаров. Можно загрузить изображение, указать название, категорию, количество и стоимость.

За работу страницы управления товарами отвечают следующие файлы:
- controllers/ProductsController.php — основной контроллер товаров
- controllers/ProductsApiController.php — файл для асинхронного обмена данными с сервером. Нужен для удаления товаров без обновления страницы.
- models/ProductModel.php — модель товаров
- models/CategoryModel.php — модель категорий
- views/products.php — страница управления товарами
- public/admin.js — файл, который отвечает за асинхронный обмен данными с сервером (удаление товаров)

### - Права пользователей

Страница для добавления и удаления администраторов. Пользователь не может лишить прав администрирования себя. на странице представлена форма, в которую необходимо ввести адрес электронной почты. Если пользователь найден в системе - он станет администратором и будет добавлен в список.

За работу страницы управления правами пользователей отвечают следующие файлы:
- controllers/UserController.php — основной контроллер страницы управления правами пользователей
- controllers/UserApiController.php — файл для асинхронного обмена данными с сервером. Нужен для лишения пользователей прав администратора без обновления страницы
- models/UserModel.php — модель пользователей
- views/users.php — страница управления правами пользователей
- public/admin.js — файл, который отвечает за асинхронный обмен данными с сервером (удаление администраторов)

### - Управление категориями

Страница для создания и изменения категорий. Категории, которые не имеют родительской категории, являются корневыми. Родительскими категориями могут быть только корневые категории.

При удалении какой-либо категории, категория у товаров меняется на "Без категории".

За работу страницы управления категориями отвечают следующие файлы:
- controllers/CategoryAdminController.php — основной контроллер страницы управления правами пользователей
- models/CategoryModel.php — модель категорий
- models/ProductModel.php — модель товаров. Нужна для изменения категори товаров при удалении категории.
- views/categoryAdmin.php — страница управления категориями
